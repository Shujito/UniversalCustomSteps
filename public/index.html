<!doctype html>
<html>
<head>
	<title>some chat</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<style type="text/css">
		body {
			background: #eee;
			padding-top: 90px;
			padding-bottom: 40px;
		}
		#controls {
			position: fixed;
			width: 100%;
			padding-top: 10px;
			padding-bottom: 10px;
			bottom: 0;
			left: 0;
			background: #555;
			text-align: center;
		}
		#message,#send {
			font-size: 20px;
			font-family: monospace;
		}
		#header {
			background: #eee;
			position: fixed;
			width: 100%;
			top: 0;
		}
	</style>
	<script type="text/javascript">
		window.onload = function() {
			var ws = new WebSocket('ws://' + window.location.host + '/api/chat');
			var messageInput = document.getElementById('message');
			var messages = document.getElementById('messages')
			function send(msg) {
				ws.send(msg);
			}
			document.getElementById('send').onclick = function() {
				send(messageInput.value)
				messageInput.value = '';
			}
			messageInput.onkeydown = function(e) {
				if (e.keyCode === 13 && !!messageInput.value) {
					send(messageInput.value)
					messageInput.value = '';
				}
			}
			ws.onopen = function(data) {
				console.log('onopen:',data);
			};
			ws.onmessage = function(data) {
				//console.log('onmessage:',data.data);
				messages.innerHTML += '<li>' + data.data + '</li>';
				window.scroll(0,window.outerHeight)
			};
			ws.onclose = function(data) {
				console.log('onclose:',data);
			};
			ws.error = function(data) {
				console.log('error:',data);
			};
		}
	</script>
</head>
<body>
<div id="header">
	<h1>Hi <span id="username">there</span>!</h1>
	<hr>
</div>
<p>chat:
<ul id="messages">
</ul>
</p>
<div id="controls">
	<input id="message" type="text"/>
	<button id="send" type="button" >Send</button>
</div>
</body>
</html>